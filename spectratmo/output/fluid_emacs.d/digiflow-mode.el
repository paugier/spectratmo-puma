

;; define several class of keywords
(setq dfc-keywords 
      '("function" "to" "step" "and" "or") )
(setq dfc-types 
      '("float" "integer" "key" "list" "rotation" "string" "vector"))
(setq dfc-constants '("ZZZZZZZZ"))
(setq dfc-events '("ZZZZZZZZZZ"))
(setq dfc-functions
'("abs" "acos" "acos_rad" "add_color" "add_color_scheme" "add_colour" "add_colour_scheme" "add_image_reader" "add_image_reader_macro" "add_image_writer" "add_menu_item" "add_menu_separator" "add_submenu" "advect_2d_psi" "allow_break" "allow_query" "animate_view" "as_thread" "asin" "asin_rad" "ask_directory" "ask_file" "ask_image" "ask_integer" "ask_list" "ask_printer" "ask_real" "ask_string" "ask_yesno" "atan" "atan_rad" "auto_correlation_2d" "auto_correlation_column" "auto_correlation_row" "autorun_file" "b_spline_2d" "b_spline_2d_least_squares" "bayer_from_rgb" "beep" "bessel" "bit_and" "bit_clear" "bit_eor" "bit_not" "bit_or" "bit_rotate" "bit_set" "bit_shift" "bit_test" "blue_from_rgb" "camera_cache_file_name" "camera_capabilities" "camera_capture_file" "camera_display_now" "camera_external_shutter_speed" "camera_frame_number" "camera_frames_captured" "camera_get_settings" "camera_gpout" "camera_grab" "camera_grab_column" "camera_grab_line" "camera_is_capturing" "camera_live_view" "camera_low_level" "camera_open_serial" "camera_override" "camera_override_sync" "camera_save_cache" "camera_serial" "camera_serial_online" "camera_set_display_rate" "camera_set_frame_offset" "camera_set_frame_rate" "camera_set_frame_straddle" "camera_set_gain" "camera_set_mode" "camera_set_strobe" "camera_set_sync_line" "camera_shutter_speed" "camera_start_capture" "camera_start_frame_straddle" "camera_stop_capture" "camera_stop_frame_straddle" "camera_switch_mode" "camera_trigger" "camera_wait_for_capture" "camera_wait_for_capture_ready" "camera_wait_for_frame" "camera_wait_for_preprocess" "camera_wait_for_sync" "cascade_views" "change_directory" "char" "close_all_views" "close_console" "close_file" "close_view" "cmy_from_rgb" "cmyk_from_rgb" "color_scheme" "color_scheme_from_image" "colour_scheme" "colour_scheme_from_image" "command_line_arguments" "compile" "compile_rp" "compiler_supplier" "compiler_version" "component_names" "computer_for_file" "contour_image" "convert_to_rp" "coord_system_add_point" "coord_system_apply_region" "coord_system_create" "coord_system_destroy" "coord_system_get_mapping" "coord_system_get_points" "coord_system_list" "coord_system_mapping" "coord_system_save" "coord_system_set_default" "coord_system_translate" "coord_system_translate_pixel" "coord_system_units" "copy_file" "copy_file_wait" "cos" "cos_rad" "count" "crash_digiflow" "create_directory" "cropped_add" "cropped_assign" "cropped_div" "cropped_div_reversed" "cropped_mul" "cropped_power" "cropped_power_reversed" "cropped_sub" "cropped_sub_reversed" "cross_correlation_2d" "cross_correlation_column" "cross_correlation_row" "curl" "current_directory" "cyan_from_rgb" "d2_dx2" "d2_dy2" "d_dx" "d_dy" "date" "degrees_from_radians" "delete_color_scheme" "delete_colour_scheme" "delete_file" "density_from_gradient" "destroy_variable" "dfc_as_latex" "dialog" "digiflow_build_date" "digiflow_directory" "digiflow_directory_url" "digiflow_help" "digiflow_licence" "digiflow_licence_type" "digiflow_site_licence" "digiflow_version" "directdraw_animate" "directdraw_animate_period" "directdraw_create" "directdraw_destroy" "directdraw_trigger" "directdraw_trigger_period" "directdraw_view" "directdraw_wait" "div" "do_not_wait" "draw_append_drawing" "draw_arc" "draw_begin_image" "draw_begin_lineto" "draw_begin_marks" "draw_begin_vector" "draw_bottom_axis" "draw_circle" "draw_clip_box" "draw_colour_scheme" "draw_create_key" "draw_defaults" "draw_destroy" "draw_embed_drawing" "draw_enable_latex" "draw_end" "draw_fill_color" "draw_fill_colour" "draw_font" "draw_get_axes" "draw_get_font_height" "draw_get_status" "draw_group_begin" "draw_group_end" "draw_image" "draw_image_scale" "draw_image_scale_vertical" "draw_install_latex_macro" "draw_key_entry" "draw_left_axis" "draw_line" "draw_line_color" "draw_line_colour" "draw_line_style" "draw_line_width" "draw_lineto" "draw_mark" "draw_mark_size" "draw_mark_type" "draw_move" "draw_no_fill" "draw_on_array" "draw_on_emf" "draw_on_file" "draw_on_view" "draw_polygon" "draw_rectangle" "draw_restore_state" "draw_right_axis" "draw_save_state" "draw_set_axes" "draw_set_base_scale" "draw_set_size" "draw_skip_points" "draw_start" "draw_text" "draw_text_color" "draw_text_colour" "draw_top_axis" "draw_user_line_style" "draw_vector" "draw_vector_scale" "draw_vector_scale_vertical" "draw_x_axis" "draw_y_axis" "dye_ideal" "dye_red_fiesta" "eigen_system" "eigen_values" "enable_timing" "end_data" "eor" "erf" "erfc" "evaluate_expression" "evaluate_periodic" "execute" "exists" "exit" "exit_digiflow" "exp" "export_to_eps" "export_to_simple_eps" "extract" "false" "fft_2d" "fft_3d" "fft_column" "fft_row" "file_details" "fill_blob_list" "fill_blobs" "filter_centile" "filter_convolution" "filter_geometric" "filter_low_pass" "filter_max" "filter_median" "filter_min" "filter_periodic_centile" "filter_periodic_convolution" "filter_periodic_geometric" "filter_periodic_low_pass" "filter_periodic_max" "filter_periodic_median" "filter_periodic_min" "filter_periodic_std_dev" "filter_std_dev" "find_blobs" "find_contour_start" "find_edge" "find_root_bisection" "find_root_secant" "fit_as_text" "fit_ellipse" "fit_expression" "fit_image_b_spline" "fit_line" "fit_periodic" "fit_spline_surface" "flip_horizontal" "flip_vertical" "floor" "flush_file" "follow_optical_flow" "for" "fractal_box_count" "fractal_box_count_digimage" "ftp_change_directory" "ftp_close" "ftp_create_directory" "ftp_current_directory" "ftp_delete_file" "ftp_get_file" "ftp_list_files" "ftp_open" "ftp_put_file" "ftp_remove_directory" "ftp_rename_file" "function_help" "gaussian_noise" "get_active_view" "get_component" "get_configuration" "get_dfc_path" "get_dialog_response" "get_file_variables" "get_global" "get_image" "get_ip_address" "get_key" "get_local_variables" "get_mac_address" "get_monitor" "get_mouse_box" "get_mouse_click" "get_mouse_line" "get_mouse_position" "get_mouse_rect" "get_process_details" "get_region" "get_submenu" "get_user_variables" "get_variable" "get_view_as_image" "get_view_class" "ghostscript" "ghostscript_end" "ghostscript_execute" "ghostscript_get_image" "ghostscript_get_output" "ghostscript_show_image" "ghostscript_start" "grad" "green_from_rgb" "grey_from_rgb" "hide_splash" "histogram" "hsi_from_rgb" "hue_from_rgb" "identity_matrix" "in_parallel" "include" "indirect" "install_function_dll" "int" "intensity_from_rgb" "interpolate_image" "inverse_fft_2d" "inverse_fft_3d" "inverse_fft_column" "inverse_fft_row" "inverse_gradient" "is_array" "is_code" "is_compound" "is_debug" "is_digiflow_licenced" "is_digiflow_licensed" "is_drawing" "is_file_local" "is_integer" "is_list" "is_live_view" "is_memo" "is_null" "is_numeric" "is_openmp" "is_parallel" "is_real" "is_running" "is_string" "is_view" "issue_command" "jpeg_get_comments" "kill_thread" "laplacian" "least_squares" "left_string" "length" "list_components" "list_file_details" "list_files" "list_files_global" "list_global_variables" "list_local_variables" "list_monitors" "list_names" "list_system_variables" "list_user_variables" "ln" "log" "log_allocated" "log_flush" "log_flush_every_time" "log_memory" "log_message" "log_start" "log_stop" "look_up_table" "lower_case" "magenta_from_rgb" "make_array" "make_like" "make_list" "make_string" "map_cartesian_to_polar" "map_polar_to_cartesian" "match_intensity_create" "matrix_multiply" "max" "max_index_x" "max_index_y" "max_string_length" "max_value" "maximise_digiflow" "maximise_view" "maximize_digiflow" "maximize_view" "mean" "mem_spectrum_column" "mem_spectrum_row" "memory_status" "memory_tidy" "message" "mid_string" "min" "min_index_x" "min_index_y" "min_value" "minimise_digiflow" "minimise_view" "minimize_digiflow" "minimize_view" "mod" "move_file" "move_icon" "multigrid" "n_components" "n_size" "new_line" "new_view" "new_view_clean" "new_view_floating" "nice_number" "nice_number_string" "not" "null" "open_binary_file" "open_console" "open_file" "open_image" "open_image_when_ready" "pack_time" "pause_thread" "pi" "pixel_contour" "pixel_coordinate" "plot" "plot_axes" "plot_axis_type" "plot_destroy" "plot_drawing" "plot_fit" "plot_get_state" "plot_image" "plot_line" "plot_new" "plot_titles" "plot_update_view" "plot_vectors" "plot_view_handle" "power_spectrum_1d" "power_spectrum_2d" "power_spectrum_column" "power_spectrum_row" "print_view" "print_view_dialog" "process" "process_as_thread" "process_time" "ptv_close" "ptv_open" "ptv_tracks" "ptv_velocity" "quit" "r_count" "r_mean" "r_sum" "radians_from_degrees" "random_array" "random_number" "randomise" "read_array" "read_binary" "read_compound_image" "read_console" "read_data" "read_file" "read_image" "read_image_details" "read_image_from_view" "read_image_when_ready" "read_into_array" "read_line" "read_table" "real" "red_from_rgb" "region_create" "region_destroy" "region_list" "registry_create_key" "registry_get_value" "registry_list_keys" "registry_set_value" "remove_spaces" "remove_trailing_zeros" "render_3d" "render_3d_isosurface" "render_points_3d" "replace_hashes" "replace_values" "resample_curve" "rescale_image" "restore_digiflow" "restore_view" "reverse_polish" "rgb_from_bayer" "rgb_from_hsi" "rgb_from_image" "right_string" "rms" "roll" "rotate_anticlockwise" "rotate_clockwise" "rotate_image" "round" "sample_values" "saturation_from_rgb" "save_view" "scatter_to_array" "scrunch_string" "search_string" "seawater_density" "serial_close" "serial_open" "serial_read" "serial_write" "set_configuration" "set_dfc_path" "set_dialog_response" "set_file_end" "set_file_pointer" "set_global" "set_variable" "shallow_water" "shift" "shift_interpolated" "show_memory_status" "sign" "sin" "sin_rad" "singular_value_decomposition" "slave_view_3d" "sleep_for" "smooth_contour" "solve_linear" "solve_poisson" "solve_svd" "sort" "sort_array" "sort_index" "sqrt" "start_directory" "start_directory_url" "start_timer" "status_bar_message" "step" "stop_view_thread" "stream_function" "streamline" "sum" "system_load" "t_index" "t_size" "tan" "tan_rad" "thread_for_view" "thread_set_stopping_time" "tile_views" "time" "time_interval" "to" "trace" "transpose" "true" "try_execute" "try_include" "turntable_average_output" "turntable_ctrl" "turntable_enable" "turntable_filter_low_pass" "turntable_filter_median" "turntable_fourier" "turntable_get_variable" "turntable_heart_beat" "turntable_output" "turntable_record" "turntable_set_speed" "turntable_set_variable" "turntable_state" "turntable_status_bar" "turntable_stop" "turntable_update_base" "turntable_update_calibration" "turntable_update_waveform" "turntable_varying_speed" "turntable_wait" "turntable_where" "uei_analog_in" "uei_analog_in_configure" "uei_analog_in_range" "uei_analog_out" "uei_analog_start" "uei_close" "uei_counter_clear_events" "uei_counter_configure" "uei_counter_gate" "uei_counter_mode" "uei_counter_pulse" "uei_counter_read" "uei_counter_reset" "uei_counter_status" "uei_counter_wait" "uei_counter_write" "uei_digital_in" "uei_digital_in_clear_events" "uei_digital_in_configure" "uei_digital_in_status" "uei_digital_in_wait" "uei_digital_out" "uei_get_configuration" "uei_open" "uei_set_configuration" "unpack_time" "unpause_thread" "upper_case" "view" "view_3d" "view_color" "view_colour" "view_counter" "view_fit_all_to_zoom" "view_fit_to_zoom" "view_get_time" "view_icon" "view_live" "view_points_3d" "view_rgb" "view_rotated" "view_scalar_colour" "view_scalar_range" "view_time" "view_title" "view_toggle_color" "view_toggle_colour" "view_variables" "view_vector_colour" "view_vector_remove_mean" "view_vector_scale" "view_vector_spacing" "view_vectors" "view_zoom" "view_zoom_all" "view_zoom_all_to_fit" "view_zoom_to_fit" "wait_for_end" "wait_for_ever" "wait_for_file" "wait_for_timer" "where" "where_is" "while" "window_from" "windows_version" "world_coordinate" "wrapped_add" "wrapped_assign" "wrapped_div" "wrapped_div_reversed" "wrapped_extract" "wrapped_mul" "wrapped_power" "wrapped_power_reversed" "wrapped_sub" "wrapped_sub_reversed" "write_array" "write_binary" "write_console" "write_file" "write_image" "write_integer_array" "write_rgb_image" "write_thesis" "www_action" "www_browse" "www_exit" "x_accumulate" "x_centroid" "x_count" "x_index" "x_index_pixel" "x_index_world" "x_max_index" "x_max_value" "x_mean" "x_min_index" "x_min_value" "x_moment" "x_rms" "x_size" "x_sum" "x_transition_index" "xor" "y_accumulate" "y_centroid" "y_count" "y_index" "y_index_pixel" "y_index_world" "y_max_index" "y_max_value" "y_mean" "y_min_index" "y_min_value" "y_moment" "y_rms" "y_size" "y_sum" "y_transition_index" "yellow_from_rgb" "z_index" "z_size")
)

;; create the regex string for each class of keywords
(setq dfc-keywords-regexp (regexp-opt dfc-keywords 'words))
(setq dfc-type-regexp (regexp-opt dfc-types 'words))
(setq dfc-constant-regexp (regexp-opt dfc-constants 'words))
(setq dfc-event-regexp (regexp-opt dfc-events 'words))
(setq dfc-functions-regexp (regexp-opt dfc-functions 'words))


;; clear memory
(setq dfc-keywords nil)
(setq dfc-types nil)
(setq dfc-constants nil)
(setq dfc-events nil)
(setq dfc-functions nil)

;; create the list for font-lock.
;; each class of keyword is given a particular face
(setq dfc-font-lock-keywords
  `(
    (,dfc-type-regexp . font-lock-type-face)
    (,dfc-constant-regexp . font-lock-constant-face)
    (,dfc-event-regexp . font-lock-builtin-face)
    (,dfc-functions-regexp . font-lock-function-name-face)
    (,dfc-keywords-regexp . font-lock-keyword-face)
    ;; note: order above matters. “dfc-keywords-regexp” goes last because
    ;; otherwise the keyword “state” in the function “state_entry”
    ;; would be highlighted.
))


;; define the mode
(define-derived-mode digiflow-mode python-mode
  "digiflow mode"
  "Major mode for editing dfc (digiflow mode)…"

  ;; code for syntax highlighting
  (setq font-lock-defaults '((dfc-font-lock-keywords)))

  ;; clear memory
  (setq dfc-keywords-regexp nil)
  (setq dfc-types-regexp nil)
  (setq dfc-constants-regexp nil)
  (setq dfc-events-regexp nil)
  (setq dfc-functions-regexp nil)
)


(provide 'digiflow-mode)